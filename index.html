<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Starsector Ship Builds</title>

<style>
*,
*::before,
*::after {
  box-sizing: border-box;
}

body {
  font-family: system-ui, sans-serif;
  background: #0e0f13;
  color: #e6e6e6;
  margin: 0;
}

/* Header */
header {
  padding: 16px;
  background: #161821;
  position: sticky;
  top: 0;
  z-index: 10;
}

input {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  background: #0e0f13;
  color: #fff;
  border: 1px solid #333;
  border-radius: 6px;
}

/* Tabs */
.tabs {
  display: flex;
  gap: 8px;
  padding: 12px 20px;
  background: #161821;
}

.tab {
  background: #0e0f13;
  color: #fff;
  border: 1px solid #333;
  padding: 8px 14px;
  border-radius: 6px;
  cursor: pointer;
}

.tab.active {
  background: #2a2d3a;
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

/* Content */
section {
  padding: 20px;
}

.category {
  margin-bottom: 40px;
}

.category h2 {
  border-bottom: 2px solid #333;
  padding-bottom: 6px;
}

.ship {
  margin-top: 20px;
}

.ship h3 {
  margin: 8px 0;
}

.images {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.images img {
  max-width: 320px;
  border-radius: 6px;
  border: 1px solid #333;
  background: #000;
  cursor: zoom-in;
}

.hidden {
  display: none;
}

.tier {
  margin-left: 8px;
  font-weight: bold;
  color: #ffd369;
}

.desc {
  margin: 6px 0 12px;
  max-width: 800px;
  line-height: 1.5;
}

.toggle {
  margin-left: 10px;
  font-size: 12px;
  background: none;
  border: none;
  color: #7aa2f7;
  cursor: pointer;
}

/* Modal */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.85);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 100;
}

.modal.open {
  display: flex;
}

.modal img {
  max-width: 95vw;
  max-height: 95vh;
  border-radius: 8px;
  border: 1px solid #444;
}
</style>
</head>

<body>

<header>
  <input id="search" placeholder="Search ships or weapons..." />
</header>

<nav class="tabs">
  <button class="tab active" data-tab="ships">Ships</button>
  <button class="tab" data-tab="weapons">Weapons</button>
</nav>

<section id="ships" class="tab-content active"></section>
<section id="weapons" class="tab-content"></section>

<div id="modal" class="modal">
  <img id="modal-img">
</div>

<script src="data.js"></script>
<script>
/* ================= DATA ================= */

const SHIPS = DATA.SHIPS;
const WEAPONS = DATA.WEAPONS;

/* ================= MODAL ================= */

const modal = document.getElementById("modal");
const modalImg = document.getElementById("modal-img");

function openModal(src) {
  modalImg.src = src;
  modal.classList.add("open");
}

modal.addEventListener("click", () => {
  modal.classList.remove("open");
  modalImg.src = "";
});

document.addEventListener("keydown", e => {
  if (e.key === "Escape") {
    modal.classList.remove("open");
    modalImg.src = "";
  }
});

/* ================= IMAGES ================= */

function createImageWithFallback(localPath) {
  const img = document.createElement("img");
  const filename = localPath.split("/").pop();
  const imgurUrl = "https://i.imgur.com/" + filename;

  img.dataset.src = imgurUrl;
  img.loading = "lazy";

  img.onerror = () => {
    img.onerror = null;
    img.src = localPath;
  };

  img.addEventListener("click", () => openModal(img.src));
  return img;
}

const observer = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    if (!entry.isIntersecting) return;
    entry.target.src = entry.target.dataset.src;
    observer.unobserve(entry.target);
  });
});

/* ================= TABS ================= */

document.querySelectorAll(".tab").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".tab, .tab-content")
      .forEach(el => el.classList.remove("active"));
    btn.classList.add("active");
    document.getElementById(btn.dataset.tab).classList.add("active");
  });
});

/* ================= SHIPS ================= */

const shipContainer = document.getElementById("ships");

for (const category in SHIPS) {
  const catDiv = document.createElement("div");
  catDiv.className = "category";
  catDiv.dataset.name = category.toLowerCase();
  catDiv.innerHTML = `<h2>${category.replace(/_/g, " ")}</h2>`;

  for (const shipName in SHIPS[category]) {
    const shipData = SHIPS[category][shipName];

    const shipDiv = document.createElement("div");
    shipDiv.className = "ship";
    shipDiv.dataset.name = shipName.toLowerCase();

    shipDiv.innerHTML = `
      <h3>
        ${shipName.replace(/_/g, " ")}
        <span class="tier">${shipData.tier ?? ""}</span>
        <button class="toggle">Details</button>
      </h3>
      ${
        shipData.description
          ? `<p class="desc hidden">${shipData.description}</p>`
          : ""
      }
    `;

    const imgDiv = document.createElement("div");
    imgDiv.className = "images";

    (shipData.images || []).forEach(src => {
      const img = createImageWithFallback(src);
      observer.observe(img);
      imgDiv.appendChild(img);
    });

    shipDiv.appendChild(imgDiv);
    catDiv.appendChild(shipDiv);
  }

  shipContainer.appendChild(catDiv);
}


/* ================= WEAPONS ================= */

const weaponContainer = document.getElementById("weapons");

for (const type in WEAPONS) {
  const typeDiv = document.createElement("div");
  typeDiv.className = "category";
  typeDiv.dataset.name = type.toLowerCase();
  typeDiv.innerHTML = `<h2>${type} Weapons</h2>`;

  for (const size in WEAPONS[type]) {
    const sizeDiv = document.createElement("div");
    sizeDiv.className = "category";
    sizeDiv.dataset.name = size.toLowerCase();
    sizeDiv.innerHTML = `<h3>${size}</h3>`;

    WEAPONS[type][size].forEach(w => {
      const div = document.createElement("div");
      div.className = "ship";
      div.dataset.name = w.name.toLowerCase();

      div.innerHTML = `
        <h3>
          ${w.name}
          <span class="tier">${w.tier}</span>
          <button class="toggle">Details</button>
        </h3>
        <p class="desc hidden">${w.description}</p>
      `;

      sizeDiv.appendChild(div);
    });

    typeDiv.appendChild(sizeDiv);
  }

  weaponContainer.appendChild(typeDiv);
}

/* ================= TOGGLE ================= */

document.addEventListener("click", e => {
  if (!e.target.classList.contains("toggle")) return;
  const desc = e.target.closest(".ship").querySelector(".desc");
  desc.classList.toggle("hidden");
  e.target.textContent = desc.classList.contains("hidden") ? "Details" : "Hide";
});

/* ================= SEARCH ================= */

document.getElementById("search").addEventListener("input", e => {
  const q = e.target.value.toLowerCase();

  document.querySelectorAll(".ship").forEach(item => {
    const name = item.dataset.name || "";
    item.classList.toggle("hidden", !name.includes(q));
  });

  document.querySelectorAll(".category").forEach(cat => {
    const hasVisible = cat.querySelector(".ship:not(.hidden)");
    cat.classList.toggle("hidden", !hasVisible);
  });
});
</script>

</body>
</html>
